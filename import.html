<!DOCTYPE html>
<html>
<head>
    <title>Import Words - Ad Infinitum</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; background: #1a1a2e; color: #eee; }
        h1 { color: #6366f1; }
        button { background: #6366f1; color: white; border: none; padding: 15px 30px; font-size: 18px; cursor: pointer; border-radius: 8px; }
        button:hover { background: #4f46e5; }
        button:disabled { background: #666; cursor: not-allowed; }
        #status { margin-top: 20px; padding: 20px; background: #2a2a4e; border-radius: 8px; }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        textarea { width: 100%; height: 200px; margin: 10px 0; background: #2a2a4e; color: #eee; border: 1px solid #444; border-radius: 8px; padding: 10px; }
    </style>
</head>
<body>
    <h1>Import Vocabulary to Ad Infinitum</h1>

    <p>Make sure you're logged in as admin first. Then paste the JSON content from <code>data/words_processed.json</code> below:</p>

    <textarea id="jsonInput" placeholder="Paste the content of words_processed.json here..."></textarea>

    <button id="importBtn" onclick="startImport()">Import Words</button>

    <div id="status"></div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCilWbme84ANKVKc2clsO5Zl1zzd9f0OEw",
            authDomain: "ad-infinitum-2eac8.firebaseapp.com",
            projectId: "ad-infinitum-2eac8",
            storageBucket: "ad-infinitum-2eac8.firebasestorage.app",
            messagingSenderId: "1033641733165",
            appId: "1:1033641733165:web:f6b7518efaeebfa8085ca4"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const status = document.getElementById('status');

        auth.onAuthStateChanged(user => {
            if (user) {
                status.innerHTML = '<p class="success">Logged in as: ' + user.email + '</p>';
            } else {
                status.innerHTML = '<p class="error">Not logged in. Please log in at index.html first, then come back here.</p>';
                document.getElementById('importBtn').disabled = true;
            }
        });

        async function startImport() {
            const jsonText = document.getElementById('jsonInput').value.trim();
            if (!jsonText) {
                status.innerHTML = '<p class="error">Please paste the JSON content first!</p>';
                return;
            }

            let words;
            try {
                words = JSON.parse(jsonText);
            } catch (e) {
                status.innerHTML = '<p class="error">Invalid JSON: ' + e.message + '</p>';
                return;
            }

            document.getElementById('importBtn').disabled = true;
            status.innerHTML = '<p>Starting import of ' + words.length + ' words...</p>';

            let imported = 0;
            let errors = 0;

            // Import in batches of 50
            const batchSize = 50;
            for (let i = 0; i < words.length; i += batchSize) {
                const batch = db.batch();
                const chunk = words.slice(i, i + batchSize);

                for (const word of chunk) {
                    const docRef = db.collection('words').doc();
                    batch.set(docRef, {
                        word: word.word || '',
                        definition: word.definition || '',
                        tldr: word.tldr || '',
                        korean: word.korean || '',
                        partOfSpeech: word.partOfSpeech || '',
                        example: word.example || '',
                        level: word.level || 1,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }

                try {
                    await batch.commit();
                    imported += chunk.length;
                    status.innerHTML = '<p>Imported ' + imported + ' / ' + words.length + ' words...</p>';
                } catch (e) {
                    errors += chunk.length;
                    console.error('Batch error:', e);
                }
            }

            status.innerHTML = '<p class="success">Done! Imported ' + imported + ' words. ' + (errors > 0 ? errors + ' errors.' : '') + '</p><p>Go back to <a href="index.html" style="color:#6366f1">index.html</a> to see them.</p>';
            document.getElementById('importBtn').disabled = false;
        }
    </script>
</body>
</html>
